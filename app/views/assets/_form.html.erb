<script>

function changeForm() {
	$.ajax({
    url: '<%= change_form_content_assets_path %>', 
    dataType: 'script',
    type: 'get', 
    data: 'resource_type='+$("#asset_resource_type").attr("value")
	});
}

function addTags() {
	var tagsArray = $("#tagsTextField").attr("value").split(",");
	$("#tagsTextField").attr("value", "") 
	var tagsHTML = ""
	var previousTags = $(".DelTag").get()
	$.each(previousTags, function(key, currEle) { 
 		tagsHTML += "<span onclick='delTag(this)' class='DelTag'>"+currEle.innerHTML+"</span>";
	});
	$.each(tagsArray, function(key, value) { 
		if(value.trim() != "") {
 			tagsHTML += "<span onclick='delTag(this)' class='DelTag'>"+value+"</span>";
 		}
	});
	$("#tags").html(tagsHTML)
}
	
function fillTagContent() {
	addTags()
	var previousTags = $(".DelTag").get()
	var tags = ""
	$.each(previousTags, function(key, currEle) {
		if(key != previousTags.length-1) { 
	 		tags += currEle.innerHTML+",";
	 	}
	 	else {
	 		tags += currEle.innerHTML
	 	}
	});
	$("#tagsTextField").attr("value", tags)
}

function delTag(currentTag) {
	 $(currentTag).remove();
}

</script>



<%= form_for @asset do |f| %>
	
	<%= render :partial => "shared/errors", :locals => { :obj => @asset } %>

	<table id='assetTable' width="800" class="ShowTable" align='center'>
	
		<tr>
			<td>Category</td>
			<td>
			<%= show_category @asset %>
			</td>
		</tr>

		<tr>
			<td><%= f.label :status %></td>
			<td>
			<% if @asset.status == "Assigned" %>
				Assigned
			<% else %>
				<%= f.select(:status, options_for_select(STATUS, @asset.status), :include_blank => "- Select -") %>
			<% end %>
			</td>
		</tr>

		<tr>
			<td><%= f.label :name %></td>
			<td><%= f.text_field :name %></td>
		</tr>
		
		<tr>
			<td><%= f.label :cost %></td>
			<td>
				<label><%= f.select(:currency_unit, options_for_select(CURRENCY, @asset.currency_unit)) %></label>
				<%= f.text_field :cost %>
			</td>
		</tr>
		
		<tr>
			<td><%= f.label :serial_number %></td>
			<td><%= f.text_field :serial_number %></td>
		</tr>
		
		<tr>
			<td><%= f.label :vendor %></td>
			<td><%= f.text_field :vendor %></td>
		</tr>
		
		<tr>
			<td><%= f.label :purchase_date %></td>
			<td><%= f.text_field :purchase_date, :value => @asset.purchase_date.try(:strftime, "%d/%m/%Y") %></td>
			
			<script>
				$(function() {
					$("#asset_purchase_date").datepicker({ dateFormat: "dd/mm/yy" });
				});
			</script>
		</tr>
		
		<tr >
			<td colspan=2>
			<div id="specifics">
				<%= render :partial => @asset.resource_type.tableize unless @asset.resource_type.blank? %>
			</div>
			</td>
		</tr>
		
		<tr>
			<td><%= f.label :description %></td>
			<td><%= f.text_area :description, :rows => 3, :columns => 80 %></td>
		</tr>
		
		<tr>
			<td><%= f.label :additional_info %></td>
			<td><%= f.text_area :additional_info, :rows => 3, :columns => 80  %></td>
		</tr>
		
		<tr>
			<td>Tags</td>
			<td>
				<div id='addTags'>
					<%= text_field_tag :tagsTextField %>
					<span id='addTagButton' onclick='addTags()'>Add</span>
					<div id='tags'></div>
				</div>
			</td>
		</tr>
		
		<tr>
			<td></td>
			<td>
				<% if @asset.new_record? %>
					<%= f.submit "Add Asset!", :onclick => "fillTagContent()" %>
				<% else %>	
					<%= f.submit "Update Asset!", :onclick => "fillTagContent()" %>
				<% end %>	
			</td>
		</tr>
	
	</table>
<% end %>

<script>
	$(".ShowTable tr:even").addClass("AlternateRow");
</script>

